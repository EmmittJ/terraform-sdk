resource "aws_instance" "web" {
  lifecycle {
    create_before_destroy = true
    prevent_destroy = false
    ignore_changes = [tags]

    precondition {
      condition     = self.ami != null
      error_message = "AMI must be specified"
    }

    postcondition {
      condition     = self.instance_state == "running"
      error_message = "Instance must be in running state"
    }
  }
  ami = "ami-12345678"
  instance_type = "t2.micro"
}

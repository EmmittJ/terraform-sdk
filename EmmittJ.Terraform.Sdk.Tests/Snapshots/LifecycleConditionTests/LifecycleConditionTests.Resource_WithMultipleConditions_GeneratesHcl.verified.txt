resource "aws_instance" "web" {
  lifecycle {

    precondition {
      condition     = var.environment != ""
      error_message = "Environment variable must be set"
    }

    precondition {
      condition     = contains(["dev", "staging", "prod"], var.environment)
      error_message = "Environment must be dev, staging, or prod"
    }

    postcondition {
      condition     = self.public_ip != ""
      error_message = "Instance must have a public IP"
    }

    postcondition {
      condition     = length(self.tags) > 0
      error_message = "Instance must have at least one tag"
    }
  }
  instance_type = "t2.micro"
}
